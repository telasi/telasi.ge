<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript">
  var marker = null;
  var map = null;
  var default_position = new google.maps.LatLng(41.7341651833187, 44.78496193885803);
  var default_zoom = 13;
  var initializeMap = function() {
    var myOptions = { center: default_position, zoom: default_zoom, mapTypeId: google.maps.MapTypeId.ROADMAP };
    map = new google.maps.Map(document.getElementById("map"), myOptions);
    marker = new google.maps.Marker({ position: default_position, map: map, animation: google.maps.Animation.DROP });
  }
  var initAddress = function() {
    var element = $('#regions :selected');
    var position = new google.maps.LatLng(element.attr('data-latitude'), element.attr('data-longitude'));
    marker.setPosition(position);
    map.panTo(position);
    $('#current_name').text(element.attr('data-name'));
    $('#current_address').text(element.attr('data-address'));
    $('#current_phone').text(element.attr('data-phone'));
  };
  $(function() {
    initializeMap();
    $('#regions').val(111);
    $('#regions').change(initAddress);
    initAddress();
    $('#myTab a').click(function (e) {
      e.preventDefault();
      $(this).tab('show');
      //drawChart();
    });
  });
</script>
<div id="map" class="map map-box map-box-space margin-bottom-40"></div>
<div class="row-fluid">
  <div class="span5" style="min-height: 100px; padding-top: 20px;">
    <ul class="nav nav-tabs" id="myTab">
      <li class="active"><a href="#tables2">ბიზნეს-ცენტრით</a></li>
      <li class=""><a href="#chart2">აბონენტის ნომრით</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="tables2">
        <div class="muted" style="margin-bottom: 8px;">აარჩიეთ სიიდან თქვენი ბიზნეს-ცენტრი</div>
        <select id="regions">
          <% Billing::RegionConfig.where(show_on_map: true).asc(:name).each do |region| %>
            <option value="<%= region.regionkey %>" data-phone="<%= region.phone %>" data-address="<%= region.address %>" data-latitude="<%= region.location_latitude %>" data-longitude="<%= region.location_longitude %>" data-name="<%= region.name %>"><%= region.name %></option>
          <% end %>
        </select>
      </div>
      <div class="tab-pane" id="chart2">
        BY ACCNUMB
      </div>
    </div>
  </div>
  <div class="span7">
    <div class="headline"><h3 id="current_name"></h3></div>
    <div><i class="icon-home"></i> <span id="current_address"></span></div>
    <div><i class="icon-phone-sign"></i> <span id="current_phone"></span></div>
  </div>
</div>
